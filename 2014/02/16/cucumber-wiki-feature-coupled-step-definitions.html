<html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><script src="/javascripts/application.js"></script><link href="/stylesheets/application.css" rel="stylesheet" /><title>mtsmfm blog - フィーチャと一対一なステップ定義(アンチパターン)</title><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /></head><body><div class="row"><div class="three columns"><h3><a href="/">mtsmfm blog</a></h3><div class="row"><div class="large btn default"><a href="https://github.com/mtsmfm"><i class="fa fa-github"></i></a></div><div class="large btn default"><a href="https://twitter.com/mtsmfm"><i class="fa fa-twitter"></i></a></div></div></div><div class="nine columns"><section class="post"><h2><a href="/2014/02/16/cucumber-wiki-feature-coupled-step-definitions.html">フィーチャと一対一なステップ定義(アンチパターン)</a></h2><time>2014-02-16</time><p>原文 : <a href="https://github.com/cucumber/cucumber/wiki/Feature-Coupled-Step-Definitions-(Antipattern)">Feature Coupled Step Definitions (Antipattern)</a></p>

<hr>

<p>フィーチャと一対一なステップ定義はフィーチャやシナリオをまたいで使うことのできないステップ定義です。
これは、ステップ定義の急増やコードの重複、そしてメンテナンスが大変になるため有害です。</p>

<h2>例</h2>

<p>架空の履歴書アプリに以下のステップがあります:</p>
<div class="highlight"><pre class="highlight plaintext"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>features/
+--edit_work_experience.feature
+--edit_languages.feature
+--edit_education.feature
+--steps/
   +--edit_work_experience_steps.rb
   +--edit_languages_steps.rb
   +--edit_education_steps.rb
</pre></td></tr></tbody></table></code></pre></div>
<p><code>edit_work_experience.feature</code> に次のようなシナリオがあります:</p>
<div class="highlight"><pre class="highlight gherkin"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kn">シナリオ</span><span class="p">:</span> 説明を追加する
  <span class="nf">前提</span> 履歴書があり、説明の編集ページを表示している
  <span class="nf">かつ</span> <span class="s">"説明"</span> に <span class="s">"Cucumber BDD tool"</span> と記入する
  <span class="nf">もし</span> <span class="s">"保存"</span> を押す
  <span class="nf">ならば</span> <span class="s">"説明"</span> に <span class="s">"Cucumber BDD tool"</span> と表示されていること
</pre></td></tr></tbody></table></code></pre></div>
<p><code>edit_work_experience_steps.rb</code> が次のように実装されています:</p>
<div class="highlight"><pre class="highlight ruby"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="err">前提</span> <span class="o">/</span><span class="err">履歴書があり、説明の編集ページを表示している</span><span class="o">/</span> <span class="k">do</span>
  <span class="vi">@employee</span> <span class="o">=</span> <span class="no">Employee</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Sally'</span><span class="p">)</span>
  <span class="vi">@employee</span><span class="p">.</span><span class="nf">create_cv</span>
  <span class="n">visits</span><span class="p">(</span><span class="s2">"/employees/</span><span class="si">#{</span><span class="vi">@employee</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">/descriptions/new"</span><span class="p">)</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div>
<h2>修正方法</h2>

<ol>
<li>ステップをドメインコンセプト毎にまとめます。<a href="https://github.com/cucumber/cucumber/wiki/Step-Organisation">ステップのまとめ方</a>を見てください。</li>
<li>step.rb ファイルを(フィーチャやシナリオに関連した名前ではなく)ドメインに関連した名前に変更します。</li>
<li><a href="https://github.com/cucumber/cucumber/wiki/Conjunction-Steps-%28Antipattern%29">結合したステップ(アンチパターン)</a>を独立したステップに分解します。</li>
</ol>
</section></div></div></body><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-48013282-1', 'auto');
  ga('send', 'pageview');
</script>
</html>
<html><head><meta charset="utf-8" /><meta content="IE=edge;chrome=1" http-equiv="X-UA-Compatible" /><script src="/javascripts/application.js"></script><link href="/stylesheets/application.css" rel="stylesheet" /><title>mtsmfm blog - SQL マスキングツール Vanir を作った</title><link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" /></head><body><div class="row"><div class="three columns"><h3><a href="/">mtsmfm blog</a></h3><div class="row"><div class="large btn default"><a href="https://github.com/mtsmfm"><i class="fa fa-github"></i></a></div><div class="large btn default"><a href="https://twitter.com/mtsmfm"><i class="fa fa-twitter"></i></a></div></div></div><div class="nine columns"><section class="post"><h2><a href="/2017/04/16/vanir.html">SQL マスキングツール Vanir を作った</a></h2><time>2017-04-16</time><p>本番データと同様の分量、分布のデータが欲しいことはよくあるが、
個人情報を含むとそのままコピってくるわけにもいかない。</p>

<p>そこで *** みたいにマスキングする必要があるが、なんかそれっぽいのが見つからなかったのでえいやで作った。</p>

<p><a href="https://github.com/mtsmfm/vanir">https://github.com/mtsmfm/vanir</a></p>

<p>名前は某見通す悪魔から。</p>

<p>マスクしたいテーブル名とカラム名の yaml に Go のテンプレート書けばおっけー。</p>

<p>ハッシュ化できるようにしたのは、メアドなどの個人情報を外部キーに使っているような設計がされてしまっている場合にも
レコードの紐付けが切れないようにするため (つらい)。</p>

<p>bcrypt で一回限りのソルトを共通で使うような方式にしてみたけれど、ここまでする必要があったのだろうか。
bcrypt の内部メソッド使いたいがためにコピってきてるのがつらい。</p>

<p>Go はほとんど書いたことないので誰か添削を。。。</p>

<p>ほんとは mRuby にしたかったけれど SQL パーサが見あたらなかった。</p>

<hr>

<p>来週の LT 資料が微塵もできてなくてやばい。</p>
</section></div></div></body><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-48013282-1', 'auto');
  ga('send', 'pageview');
</script>
</html>